import{h as F,Y as P,_ as A}from"./index.b999f3ae.js";/* empty css              *//* empty css              *//* empty css               */import{d as M,r as R,o as V,bD as L,bO as U,C as H,D as O,aI as h,aH as w,aM as S,aN as C,a$ as T,ba as q,bE as j,bJ as z,be as G,bf as J,G as E}from"./arco.b289f6bb.js";import{h as K}from"./vue.e0867ae8.js";import{e as Y,b as Q,g as W}from"./serial.c741fbda.js";import"./chart.7501771f.js";const B=x=>(G("data-v-ace1b18a"),x=x(),J(),x),X={class:"container"},Z=B(()=>E("div",{id:"canvasDiv",style:{zoom:"250%"}},null,-1)),tt=B(()=>E("br",null,null,-1)),et={name:"Backup"},at=M({...et,setup(x){const m=F(),b=R({binaryFile:void 0,loading:!1}),D=K();V(()=>{D.query.url&&N(D.query.url)});const N=e=>{const s=document.createElement("canvas");s.width=128,s.height=64;const p=s.cloneNode(),a=document.getElementById("canvasDiv");a.innerHTML="",a==null||a.append(s,p);const c=new Image;c.src=e,c.onload=()=>{const n=s.getContext("2d");n==null||n.drawImage(c,0,0,128,64);const d=n==null?void 0:n.getImageData(0,0,s.width,s.height).data;function o(r,u){const t=(u*128+r)*4;return d[t]+d[t+1]+d[t+2]>128*3?0:1}const g=p.getContext("2d"),_=g.getImageData(0,0,p.width,p.height);for(let r=0;r<64;r++)for(let u=0;u<128;u++){const t=(r*128+u)*4,f=!o(u,r);_.data[t]=f*255,_.data[t+1]=f*255,_.data[t+2]=f*255,_.data[t+3]=255}g.putImageData(_,0,0);const I=new Uint8Array(1024);let y=0;for(let r=0;r<64;r+=8)for(let u=0;u<128;u++){let i=0;for(let t=0;t<8;t++)i|=o(u,r+t)<<t;I[y++]=i}b.binaryFile=I}},$=()=>{const e=document.createElement("input");e.type="file",e.onchange=async()=>{const s=new Blob([e.files[0]],{type:"application/octet-stream"}),p=URL.createObjectURL(s),a=document.createElement("canvas");a.width=128,a.height=64;const c=a.cloneNode(),n=document.getElementById("canvasDiv");n.innerHTML="",n==null||n.append(a,c);const d=new Image;d.src=p,d.onload=()=>{const o=a.getContext("2d");o==null||o.drawImage(d,0,0,128,64);const g=o==null?void 0:o.getImageData(0,0,a.width,a.height).data;function _(i,t){const l=(t*128+i)*4;return g[l]+g[l+1]+g[l+2]>128*3?0:1}const I=c.getContext("2d"),y=I.getImageData(0,0,c.width,c.height);for(let i=0;i<64;i++)for(let t=0;t<128;t++){const l=(i*128+t)*4,v=!_(t,i);y.data[l]=v*255,y.data[l+1]=v*255,y.data[l+2]=v*255,y.data[l+3]=255}I.putImageData(y,0,0);const r=new Uint8Array(1024);let u=0;for(let i=0;i<64;i+=8)for(let t=0;t<128;t++){let f=0;for(let l=0;l<8;l++)f|=_(t,i+l)<<l;r[u++]=f}b.binaryFile=r}},e.click()},k=async()=>{var p,a,c,n,d;if(m.connectState!=!0){alert(sessionStorage.getItem("noticeConnectK5"));return}if(((p=m.configuration)==null?void 0:p.uart)=="official"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}if(((a=m.configuration)==null?void 0:a.charset)!="losehu"&&((c=m.configuration)==null?void 0:c.charset)!="gb2312"){alert(sessionStorage.getItem("noticeVersionNoSupport"));return}b.loading=!0;let e=123728;((n=m.configuration)==null?void 0:n.charset)=="gb2312"&&(e=8320),await Y(m.connectPort);const s=b.binaryFile;for(let o=e;o<s.length+e;o+=128)await Q(m.connectPort,o,s.slice(o-e,o-e+128),128,(d=m.configuration)==null?void 0:d.uart);await W(m.connectPort),b.loading=!1};return(e,s)=>{const p=P,a=T,c=q,n=L,d=U,o=j,g=z;return H(),O("div",X,[h(p,{items:[e.$t("menu.list"),e.$t("menu.image")]},null,8,["items"]),h(g,{gutter:20,align:"stretch"},{default:w(()=>[h(o,{span:24},{default:w(()=>[h(d,{loading:b.loading,tip:"\u5199\u5165\u4E2D...",style:{width:"100%"}},{default:w(()=>[h(n,{class:"general-card",title:e.$t("menu.image")+e.$t("global.onStart")},{default:w(()=>[Z,tt,h(c,null,{default:w(()=>[h(a,{onClick:$},{default:w(()=>[S(C(e.$t("tool.selectImage")),1)]),_:1}),h(a,{type:"primary",disabled:!b.binaryFile,onClick:k},{default:w(()=>[S(C(e.$t("tool.write")),1)]),_:1},8,["disabled"])]),_:1})]),_:1},8,["title"])]),_:1},8,["loading"])]),_:1})]),_:1})])}}});const ut=A(at,[["__scopeId","data-v-ace1b18a"]]);export{ut as default};
